<!DOCTYPE html>
<html>
<head>
    <title>Translation Test</title>
    <style>
        body { font-family: system-ui; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .error { background: #fee; border-color: #fcc; }
        .success { background: #efe; border-color: #cfc; }
        button { padding: 8px 16px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Chrome Built-in AI Translation Test</h1>
    
    <div class="test-section">
        <h2>Language Detection Test</h2>
        <input type="text" id="detectText" value="Hello, how are you today?" style="width: 300px;">
        <button onclick="testDetection()">Detect Language</button>
        <div id="detectResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>Translation Test</h2>
        <input type="text" id="translateText" value="Hello, how are you today?" style="width: 300px;">
        <select id="targetLang">
            <option value="es">Spanish</option>
            <option value="fr">French</option>
            <option value="de">German</option>
            <option value="ja">Japanese</option>
        </select>
        <button onclick="testTranslation()">Translate</button>
        <div id="translateResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>API Availability</h2>
        <button onclick="checkAvailability()">Check All APIs</button>
        <div id="availabilityResult" class="result"></div>
    </div>

    <script type="module">
        import { translateText, ensureLanguageDetector } from './scripts/ai/translator.js';
        
        window.testDetection = async function() {
            const text = document.getElementById('detectText').value;
            const result = document.getElementById('detectResult');
            
            try {
                const detector = await ensureLanguageDetector();
                const detection = await detector.detect(text);
                
                result.className = 'result success';
                result.innerHTML = `
                    <strong>Detection Results:</strong><br>
                    Language: ${detection[0].detectedLanguage}<br>
                    Confidence: ${(detection[0].confidence * 100).toFixed(1)}%
                `;
            } catch (error) {
                result.className = 'result error';
                result.textContent = `Error: ${error.message}`;
            }
        };
        
        window.testTranslation = async function() {
            const text = document.getElementById('translateText').value;
            const targetLang = document.getElementById('targetLang').value;
            const result = document.getElementById('translateResult');
            
            try {
                const translation = await translateText(text, targetLang);
                
                result.className = 'result success';
                result.innerHTML = `
                    <strong>Translation Results:</strong><br>
                    Original (${translation.sourceLanguage}): ${text}<br>
                    Translated (${translation.targetLanguage}): ${translation.text}<br>
                    Was translated: ${translation.translated ? 'Yes' : 'No'}<br>
                    Detection confidence: ${(translation.confidence * 100).toFixed(1)}%
                `;
            } catch (error) {
                result.className = 'result error';
                result.textContent = `Error: ${error.message}`;
            }
        };
        
        window.checkAvailability = async function() {
            const result = document.getElementById('availabilityResult');
            const apis = [
                { name: 'LanguageDetector', check: () => LanguageDetector.availability() },
                { name: 'Translator (en→es)', check: () => Translator.availability({ sourceLanguage: 'en', targetLanguage: 'es' }) },
                { name: 'Translator (es→en)', check: () => Translator.availability({ sourceLanguage: 'es', targetLanguage: 'en' }) },
                { name: 'Prompt API', check: () => LanguageModel.availability() },
                { name: 'Summarizer', check: () => Summarizer.availability() }
            ];
            
            let html = '<strong>API Availability:</strong><br>';
            
            for (const api of apis) {
                try {
                    const status = await api.check();
                    const color = status === 'available' ? 'green' : status === 'downloadable' ? 'orange' : 'red';
                    html += `<span style="color: ${color}">• ${api.name}: ${status}</span><br>`;
                } catch (error) {
                    html += `<span style="color: red">• ${api.name}: error - ${error.message}</span><br>`;
                }
            }
            
            result.className = 'result';
            result.innerHTML = html;
        };
    </script>
</body>
</html>